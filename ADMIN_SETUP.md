# Настройка администраторов в Nebulahunt WebClient

## Обзор

Клиентская часть Nebulahunt поддерживает два типа аутентификации:

1. **Пользователи** - вход через Telegram WebApp (без 2FA)
2. **Администраторы** - вход через email + Google 2FA

## Структура страниц

### Страницы для пользователей

-   `/login` - Вход через Telegram WebApp

### Страницы для администраторов

-   `/admin/login` - Вход администратора с email + 2FA
-   `/admin/init` - Инициализация новых администраторов и супервайзера

## Настройка

### 1. Переменные окружения

Создайте файл `.env` в корне проекта:

```env
# API URL
VITE_API_URL=http://localhost:5000

# Режим разработки
VITE_DEV_MODE=true
VITE_MOCK_API=true
```

### 2. Запуск в режиме разработки

```bash
npm run dev
```

## Использование

### Инициализация супервайзера

1. Откройте `/admin/init`
2. Нажмите "Инициализировать супервайзера"
3. Скопируйте QR-код или секрет
4. Настройте Google Authenticator

### Инициализация администратора

1. Откройте `/admin/init`
2. Введите email администратора
3. Введите секретный ключ (из переменной `ADMIN_INIT_SECRET`)
4. Нажмите "Инициализировать администратора"
5. Настройте Google Authenticator

### Вход администратора

1. Откройте `/admin/login`
2. Введите email
3. Введите код из Google Authenticator
4. Получите доступ к админ-панели

## Режим разработки

В режиме разработки (`VITE_DEV_MODE=true`) доступны:

-   Автозаполнение тестовых данных
-   Мок-API для тестирования
-   Отладочная информация

### Тестовые данные

-   Email: `admin@test.com`
-   Секретный ключ: `supersecret`
-   2FA код: любой 6-значный код

## API Endpoints

### Администраторы

-   `POST /admin/login` - Логин администратора
-   `POST /admin/2fa/verify` - Верификация 2FA
-   `POST /admin/init` - Инициализация администратора
-   `POST /admin/supervisor/init` - Инициализация супервайзера

### Пользователи

-   `POST /auth/registration` - Регистрация через Telegram
-   `POST /auth/login` - Логин через Telegram

## Безопасность

### Рекомендации

1. **В продакшене** отключите `VITE_MOCK_API`
2. **Используйте HTTPS** для всех API запросов
3. **Храните секретные ключи** в безопасном месте
4. **Регулярно обновляйте** 2FA секреты

### Ограничения

-   Инициализация супервайзера: 1 запрос в час
-   Административные операции: 10 запросов в минуту
-   2FA коды действительны 30 секунд

## Устранение неполадок

### Проблема: "API URL not configured"

**Решение**: Проверьте переменную `VITE_API_URL` в `.env`

### Проблема: "Mock API not working"

**Решение**: Убедитесь, что `VITE_MOCK_API=true` в режиме разработки

### Проблема: "2FA verification failed"

**Решение**:

1. Проверьте время на устройстве
2. Убедитесь, что используете правильный код
3. Проверьте, что код не устарел

### Проблема: "Admin not found"

**Решение**: Убедитесь, что администратор был инициализирован через `/admin/init`

## Разработка

### Добавление новых страниц

1. Создайте компонент в `src/pages/`
2. Добавьте маршрут в `src/App.tsx`
3. Обновите навигацию в `src/components/Layout.tsx`

### Добавление новых API endpoints

1. Добавьте мок-данные в `src/lib/api.ts`
2. Обновите типы в `src/contexts/AuthContext.tsx`
3. Добавьте методы в соответствующие сервисы

### Стилизация

Проект использует Tailwind CSS. Основные классы:

-   `bg-primary-600` - Основной цвет
-   `text-gray-900` - Основной текст
-   `border-gray-300` - Границы
-   `rounded-md` - Скругления
